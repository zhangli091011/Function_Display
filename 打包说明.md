# 打包安装包说明

## 📦 打包流程

### 方法一：自动打包（推荐）

1. **安装打包工具**
```bash
pip install pyinstaller
```

2. **运行打包脚本**
```bash
python build_installer.py
```

3. **生成安装程序**
   - 下载并安装 [Inno Setup](https://jrsoftware.org/isdl.php)
   - 右键点击 `installer_script.iss`
   - 选择 "Compile" 编译
   - 安装包将生成在 `installer_output` 目录

### 方法二：手动打包

#### 步骤 1：打包可执行文件
```bash
pyinstaller --name=数学函数计算器 ^
            --windowed ^
            --onefile ^
            --add-data=README.md;. ^
            --add-data=使用说明.md;. ^
            --hidden-import=PyQt5 ^
            --hidden-import=matplotlib ^
            main.py
```

#### 步骤 2：测试可执行文件
```bash
dist\数学函数计算器.exe
```

#### 步骤 3：创建安装包
使用 Inno Setup 编译 `installer_script.iss`

---

## 🎯 打包选项说明

### PyInstaller 参数
- `--name`: 可执行文件名称
- `--windowed`: 不显示控制台窗口（GUI 程序）
- `--onefile`: 打包成单个 .exe 文件
- `--icon`: 指定程序图标（需要 .ico 文件）
- `--add-data`: 包含额外文件（文档等）
- `--hidden-import`: 显式导入模块

### Inno Setup 功能
- 创建标准 Windows 安装向导
- 自动创建开始菜单快捷方式
- 可选桌面快捷方式
- 卸载程序
- 安装路径选择

---

## 📁 输出文件

### 打包后的目录结构
```
项目根目录/
├── dist/
│   └── 数学函数计算器.exe    # 可执行文件
├── build/                      # 临时构建文件
├── installer_output/           # 安装包输出目录
│   └── 数学函数计算器_安装程序_v1.0.exe
└── installer_script.iss        # Inno Setup 脚本
```

---

## 🔧 常见问题

### 问题 1：PyInstaller 未找到
**解决**：
```bash
pip install pyinstaller
```

### 问题 2：打包后程序无法运行
**原因**：缺少依赖或路径问题
**解决**：
- 检查 `--hidden-import` 是否包含所有依赖
- 使用 `--debug=all` 查看详细错误
- 尝试 `--onedir` 模式（生成文件夹而非单文件）

### 问题 3：中文文件名乱码
**解决**：
- 确保脚本使用 UTF-8 编码
- Inno Setup 脚本使用 UTF-8 with BOM

### 问题 4：程序体积过大
**原因**：包含了不必要的库
**解决**：
- 使用虚拟环境，只安装必要的包
- 添加 `--exclude-module` 排除不需要的模块

### 问题 5：Matplotlib 图表不显示
**解决**：
- 添加 `--hidden-import=matplotlib.backends.backend_qt5agg`
- 确保 PyQt5 正确打包

---

## 🎨 添加程序图标

### 创建图标文件
1. 准备一张 256x256 的 PNG 图片
2. 使用在线工具转换为 .ico 格式
   - 推荐：https://convertio.co/zh/png-ico/
3. 将 `icon.ico` 放在项目根目录

### 修改打包命令
在 `build_installer.py` 中已包含图标参数：
```python
'--icon=icon.ico'
```

---

## 📊 打包大小优化

### 优化前（约 150-200 MB）
- 包含完整 Python 环境
- 所有依赖库

### 优化方法
1. **使用虚拟环境**
```bash
python -m venv venv_build
venv_build\Scripts\activate
pip install -r requirements.txt
pip install pyinstaller
python build_installer.py
```

2. **排除不必要的模块**
```python
'--exclude-module=tkinter',
'--exclude-module=unittest',
```

3. **使用 UPX 压缩**
```bash
# 下载 UPX: https://upx.github.io/
pyinstaller --upx-dir=upx_path ...
```

### 优化后（约 80-120 MB）

---

## 🚀 分发安装包

### 文件清单
- `数学函数计算器_安装程序_v1.0.exe` - 安装程序
- `使用说明.md` - 用户手册
- `README.md` - 项目说明

### 分发渠道
1. **学校内网**：上传到教学资源平台
2. **U盘分发**：拷贝安装程序
3. **网盘分享**：百度网盘、阿里云盘等
4. **GitHub Release**：发布到 GitHub

### 安装说明（给用户）
1. 双击运行 `数学函数计算器_安装程序_v1.0.exe`
2. 按照向导提示完成安装
3. 从开始菜单或桌面启动程序
4. 首次运行可能需要几秒钟加载

---

## 📝 版本管理

### 更新版本号
修改 `build_installer.py` 和 `installer_script.iss` 中的版本号：
```python
#define MyAppVersion "1.1"  # 更新这里
```

### 版本命名规范
- 1.0 - 初始版本
- 1.1 - 小功能更新
- 2.0 - 重大功能更新

---

## 🔐 代码签名（可选）

### 为什么需要签名
- 避免 Windows SmartScreen 警告
- 提升用户信任度

### 如何签名
1. 购买代码签名证书
2. 使用 `signtool` 签名
```bash
signtool sign /f certificate.pfx /p password /t http://timestamp.digicert.com dist\数学函数计算器.exe
```

---

## 📞 技术支持

如遇到打包问题，请检查：
1. Python 版本（建议 3.8-3.11）
2. PyInstaller 版本（建议 5.0+）
3. 依赖包版本（见 requirements.txt）
4. 操作系统（Windows 10/11）

---

## ✅ 打包检查清单

- [ ] 安装 PyInstaller
- [ ] 准备图标文件（可选）
- [ ] 运行 `python build_installer.py`
- [ ] 测试 `dist\数学函数计算器.exe`
- [ ] 安装 Inno Setup
- [ ] 编译 `installer_script.iss`
- [ ] 测试安装程序
- [ ] 在干净的系统上测试安装
- [ ] 准备分发文档

---

## 🎉 完成

打包完成后，你将获得：
- ✅ 独立的 Windows 可执行文件
- ✅ 专业的安装向导
- ✅ 开始菜单快捷方式
- ✅ 完整的卸载功能

现在可以将安装包分发给用户了！
